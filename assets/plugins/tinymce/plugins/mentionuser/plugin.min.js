!function(){"use strict";tinymce.PluginManager.add("mentionuser",(function(editor,url){let usersIds=[],strCapitalize=function(str){let strLowerCase,arr=str.toLowerCase().split(" "),result=[];return arr.forEach((function(str,index){0==index&&(result=str.replace(/^\w/,c=>c.toUpperCase())),index>0&&(result+=" "+str.replace(/^\w/,c=>c.toUpperCase()))})),result},watchUsersAtUpdate=function(spnTagsAt){if(0==spnTagsAt.length)usersIds=[];else{let arr=[];spnTagsAt.forEach((function(el,index){arr.push(el.dataset.id)})),usersIds=arr}editor.execCallback("mention_users_selected",usersIds)},formatAt=function(at){let arr,result;return at.split("-").forEach((function(str,index){0==index&&(result=str),index>0&&(result+=str)})),result},getUsers=function(pattern){let users;return editor.getParam("mention_users").filter((function(user){let at=user.at.toLowerCase(),search=pattern.toLowerCase();return at.includes(search)}))},loadStyleshet=function(){let fileref=document.createElement("link");fileref.rel="stylesheet",fileref.type="text/css",fileref.href=`${url}/style.css?v=${(new Date).getTime()}`,document.getElementsByTagName("head")[0].appendChild(fileref)};return editor.on("keyup",(function(e){let keycode=e.keyCode,el,spnTagsAt=e.target.querySelectorAll("span.mention.tag.at");8!==keycode&&46!==keycode||watchUsersAtUpdate(spnTagsAt)})),editor.ui.registry.addAutocompleter("mentionuser",{ch:"@",minChars:1,columns:1,highlightOn:["mention_at"],fetch:function(pattern){return new tinymce.util.Promise((function(resolve){let results;resolve(getUsers(pattern).map((function(user){var avatar=user.avatar?user.avatar.path:"assets/plugins/tinymce/mentionuser/profile-default.png";return{type:"cardmenuitem",value:user.id+"|"+user.at+"|"+user.name,items:[{type:"cardimage",src:url+avatar,classes:["tox-mention__avatar"]},{type:"cardcontainer",direction:"vertical",items:[{type:"cardtext",text:`@${formatAt(user.at)}`,name:"mention_at",classes:["tox-mention__name"]}]}]}})))}))},onAction:function(autocompleteApi,rng,value){let parts=value.split("|"),id=parts[0],at=parts[1],name=parts[2];usersIds.push(id);let content=`<span class="mention tag at" title="${strCapitalize(name)}" data-id="${id}" contenteditable="false">@${formatAt(at)}</span>`;editor.selection.setRng(rng),editor.insertContent(content),editor.execCallback("mention_users_selected",usersIds),autocompleteApi.hide()}}),loadStyleshet(),{getMetadata:function(){return{name:"Mention Uset At",url:"https://example.com/docs/customplugin"}}}}))}();